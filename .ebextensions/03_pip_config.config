files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/01_configure_pip.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      set -xe
      
      # Create alternative temp directory
      mkdir -p /var/app/pip-tmp
      chmod 1777 /var/app/pip-tmp
      
      # Clean up /tmp
      find /tmp -type f -name "*.whl" -mtime +0 -delete 2>/dev/null || true
      find /tmp -type f -name "*.tar.gz" -mtime +0 -delete 2>/dev/null || true
      find /tmp -type d -name "pip-*" -mtime +0 -exec rm -rf {} + 2>/dev/null || true
      
      # Export environment variables for pip
      export TMPDIR=/var/app/pip-tmp
      export TEMP=/var/app/pip-tmp
      export TMP=/var/app/pip-tmp
      export PIP_NO_CACHE_DIR=1

option_settings:
  aws:elasticbeanstalk:application:environment:
    TMPDIR: "/var/app/pip-tmp"
    PIP_NO_CACHE_DIR: "1"